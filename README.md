# faust-stratus
A Faust architecture file targeting the Chaos Stratus pedal, and tools to help use it

Your most important resources:

* [Faust](https://faust.grame.fr/) - [do the YouTube workshops!](https://ccrma.stanford.edu/~rmichon/faustWorkshops/course2015)
* [Stratus Developers Portal](https://github.com/chaosaudio/Dev-Portal)
* [The Faust Architecture File for The Chaos Strauss](./stratus.cpp)
* [A Python wrapper for any Faust-developed Stratus effect built using `stratus.cpp`](./stratus.py). See below for details

## Usage

There are two modes of usage - "classic" and "Embedded". Embedded
will, HOPEFULLY become the _the_ way one day - because it involves installing all the tools
on the Stratus, and, of course, since THAT is possible (and they don't take up much space) there is
no reason why they wouldn't become part of the default firmware in the future. For now, though, it
is a very experimental mode and I bear no responsibility if you break your Stratus.

### Classic mode
For the moment you have to have the Faust compiler installed locally (but not on the Stratus)

* Download the [stratus.cpp](./stratus.cpp) file to a conveniently located local place
* Design and test your pipeline in the [Faust IDE](https://faustide.grame.fr/)
  * Represent Stratus knobs using `vslider` and/or `hslider`
  * ORDER your sliders by using a label with the syntax `[idx]MySlider` where idx is a non-negative
    integer. The actual label does not affect what your kob is called in the Stratus app is called. 
	Stratus knobs themselves are numbered left-to-right, top-to-bottom.
  * Stratus switches are not yet supported.
* Export the `.dsp` code from the IDE to a local file
* Generate the full C++ code using the Faust compiler:

   ```
   faust -a [where you put the architecture file]/stratus.cpp [path to the DSP file] -o [what you want the C++ file to be called]
   ```
* You can use the [included build script](/faust2stratus.sh) to run the Faust compiler _and_ compile the resulting C++ file 
  on your local machine, which will then allow you to test it locally using the [python test script](./stratus.py)

* Copy the generated C++ file to the Stratus
* Compile that as described on the Stratus developers portal
* Do whatever else to get the effect loaded into the Stratus and testable (again, see the developer portal)

### Embedded mode
For THIS to work you have to have `docker` installed locally (absolutely NOT on your stratus!!!). 

If you aren't using a Intel 64bit architecture ... well I haven't tested this build for you, but it SHOULD work.

Anyway, installing SHOULD be straightforward :)

* Plug your stratus into your computer via USB
* FInd the Stratus root password that will have been sent to you when you signed up
* Run the [install-sdk](./install-sdk) command (entering the password when prompted)

If that worked, you are ready! NOW...

* Design and test your pipeline in the [Faust IDE](https://faustide.grame.fr/)
  * Represent Stratus knobs using `vslider` and/or `hslider`
  * ORDER your sliders by using a label with the syntax `[idx]MySlider` where idx is a non-negative
    integer. The actual label does not affect what your kob is called in the Stratus app is called. 
	  Stratus knobs themselves are numbered left-to-right, top-to-bottom.
  * Stratus switches are not yet supported.
* Export the `.dsp` code from the IDE to a local file

So you now have the DSP file on your local computer. Since you have installed the SDK on the Stratus, 
all you need to do to get the effect implementation onto the stratus AND to get local backups of the 
artifacts generated by the build process is enter the command:

```
sdk-build-effect <the-location--of-your-DSP-file>
```

Again, you'll need to have the Stratus connected to the computer by USB, and you'll need to 
enter the Stratus password when prompted.

If THAT works, you'll end up with a C++ file and a shared library object in the same
directory as your DSP file, and in the `/root` directory on the Stratus.

(However, note that, unless your local machine is an ARM 7 system, the generated `so`
file will not work on your local machine - to have one that works locally, follow the
first few steps of the [classic build](#classic-mode) process, above).

You can now use the shared library as the implementation of your effect - see the
Stratus Developer Portal for instructions on how to do that.

## Using the Python wrapper
If you want to use the [Python interface](./stratus.py) to test the effect without having to load it up in 
the pedal itself, you will need to add the `-DCINTERFACE` option to the C++ compile command line - and, 
of course, if that's what you are doing, you don't even need to compile the C++ code on the Stratus - just 
compile it locally to test it and only compile it on the Stratus itself when you are happy that it works.