# faust-stratus
A Faust architecture file targeting the Chaos Stratus pedal, and tools to help use it

Your most important resources:

* [Faust](https://faust.grame.fr/) - [do the YouTube workshops!](https://ccrma.stanford.edu/~rmichon/faustWorkshops/course2015)
* [Stratus Developers Portal](https://github.com/chaosaudio/Dev-Portal)
* [The Faust Architecture File for The Chaos Strauss](./stratus.cpp)
* [A Python wrapper for any Faust-developed Stratus effect built using `stratus.cpp`](./stratus.py). See below for details

## Installation

Download the latest version of the SDK

You can install this SDK in either of two places - or both!

* Locally, on your standard computer.
  * You must have Faust installed on the same computer
  * Use the [install-local](command) to install the Stratus-related components
  * After this you can follow the [Classic](#classic-mode) development life cycle for your Faust-designed Stratus effects libraries
* "Embedded" into your Stratus.
  * You must know the Stratus root password in order to do this
  * You must plug your Stratus into the computer via a USB C connection
  * Use the [install-sdk](command) to install Faust AND the Stratus-related components onto the Stratus
  * After this you can follow the [Embedded](#embedded-mode) development life cycle for your Faust-designed Stratus effects libraries

## Usage
There are two modes of usage - "Classic" and "Embedded". Embedded
will, HOPEFULLY become the _the_ way one day - because it involves installing all the tools
on the Stratus, and, of course, since THAT is possible (and they don't take up much space) there is
no reason why they wouldn't become part of the default firmware in the future. For now, though, it
is a very experimental mode and I bear no responsibility if you break your Stratus.

### Classic mode
For the moment you have to have the Faust compiler installed locally (but not on the Stratus)

* Design and test your pipeline in the [Faust IDE](https://faustide.grame.fr/)
  * Represent Stratus knobs using `vslider` and/or `hslider`
  * Represent Stratus switches using either `checkbox`, or `nvalue` with a minimum value of 0, a maximum value of 1 or 2, and a step value of 1.
  * ORDER your sliders and switches by using a label with the syntax `[idx]MySlider` where idx is a non-negative
    integer. The actual label does not affect what your kob is called in the Stratus app is called. 
	  Stratus knobs themselves are numbered left-to-right, top-to-bottom.
* Export the `.dsp` code from the IDE to a local file
* Generate the full C++ code using the Faust compiler:

   ```
   faust2Stratus [path to your DSP file]
   ```

* Copy the generated C++ file (in the same folder as the DSP file) to the Stratus
* Compile that as described on the Stratus developers portal
* Do whatever else to get the effect loaded into the Stratus and testable (again, see the developer portal)

You will also get a shared library generated - which is pretty useless on your computer - UNLESS you opt into
the C interface in the build...

   ```
   faust2Stratus [path to your DSP file] true
   ```

If you do THAT then you can use the installed Python interface to test your effect library outside of the Stratus -
see the [tester.py](./local/tests/tester.py) file for a basic example of using that interface.

### Embedded mode

Embedded mode means you don't need build tools on your computer - everything is on the Stratus.

* Design and test your pipeline in the [Faust IDE](https://faustide.grame.fr/)
  * Represent Stratus knobs using `vslider` and/or `hslider`
  * Represent Stratus switches using either `checkbox`, or `nvalue` with a minimum value of 0, a maximum value of 1 or 2, and a step value of 1.
  * ORDER your sliders and switches by using a label with the syntax `[idx]MySlider` where idx is a non-negative
    integer. The actual label does not affect what your kob is called in the Stratus app is called. 
	  Stratus knobs themselves are numbered left-to-right, top-to-bottom.
* Export the `.dsp` code from the IDE to a local file

So you now have the DSP file on your local computer. Since you have installed the SDK on the Stratus, 
all you need to do to get the effect implementation onto the stratus AND to get local backups of the 
artifacts generated by the build process is enter the command:

```
./sdk-build-effect <the-location--of-your-DSP-file>
```

Again, you'll need to have the Stratus connected to the computer by USB, and you'll need to 
enter the Stratus password when prompted.

If THAT works, you'll end up with a C++ file and a shared library object in the same
directory as your DSP file, and in the `/root` directory on the Stratus.

(However, note that, unless your local machine is an ARM 7 system, the generated `so`
file will not work on your local machine - to have one that works locally, follow the
first few steps of the [classic build](#classic-mode) process, above).

You can now use the shared library as the implementation of your effect - see the
Stratus Developer Portal for instructions on how to do that.

## Using the Python wrapper
If you want to use the [Python interface](./stratus.py) to test the effect without having to load it up in 
the pedal itself, you will need to add the `-DCINTERFACE` option to the C++ compile command line - and, 
of course, if that's what you are doing, you don't even need to compile the C++ code on the Stratus - just 
compile it locally to test it and only compile it on the Stratus itself when you are happy that it works.